<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Consulta Firebird</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select, button { margin: 5px 0; padding: 5px; }
        table { border-collapse: collapse; margin-top: 20px; width: 100%; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Consulta Firebird</h1>

    <label for="table">Tabela:</label>
    <input type="text" id="table" value="FC12000">

    <label for="nrrqu">NRRQU:</label>
    <input type="number" id="nrrqu">

    <button onclick="consultar()">Consultar</button>

    <div id="resultado"></div>

    <script>
        async function consultar() {
            const table = document.getElementById('table').value;
            const nrrqu = document.getElementById('nrrqu').value;

            // Monta o JSON de filtros
            const body = {
                filter_group: null,
                limit: 50,
                offset: 0
            };

            if (nrrqu) {
                body.filter_group = {
                    logic: "AND",
                    filters: [
                        { column: "NRRQU", op: "=", value: parseInt(nrrqu) }
                    ]
                };
            }

            try {
                const response = await fetch(`https://apifcerta.onrender.com/table/${table}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const err = await response.json();
                    alert("Erro: " + err.detail);
                    return;
                }

                const data = await response.json();
                mostrarTabela(data.data);
            } catch (error) {
                alert("Erro de conexão: " + error.message);
            }
        }

        function mostrarTabela(dados) {
            const container = document.getElementById('resultado');
            container.innerHTML = "";

            if (dados.length === 0) {
                container.innerHTML = "<p>Nenhum resultado encontrado.</p>";
                return;
            }

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            // Cabeçalho
            const headerRow = document.createElement('tr');
            Object.keys(dados[0]).forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            // Linhas
            dados.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(row).forEach(val => {
                    const td = document.createElement('td');
                    td.textContent = val;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            container.appendChild(table);
        }
    </script>
</body>
</html>
